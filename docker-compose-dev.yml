version: "3.5"
services:
  rchain-frontend:
    container_name: rchain-cloud-frontend
    environment:
    - INTERNAL_FRONTEND_PORT=${INTERNAL_FRONTEND_PORT}
    - EXTERNAL_FRONTEND_PORT=${EXTERNAL_FRONTEND_PORT}
    - BACKEND_PORT=${BACKEND_PORT}
    - HTTPS=${HTTPS}
    - IP=${IP}
    build:
      context: frontend
      dockerfile: Dockerfile.rchaincloudfrontend
    ports:
    - ${EXTERNAL_FRONTEND_PORT}:${INTERNAL_FRONTEND_PORT}
    volumes:
    - ./frontend/:/home/node/app/
    - /etc/letsencrypt/live/rchain.cloud/fullchain.pem:/home/node/app/node_modules/webpack-dev-server/ssl
    depends_on:
    - rchain-backend-standalone
    networks:
    - rnode-net
  rchain-backend-standalone:
    container_name: rchain-cloud-backend-standalone
    build:
      context: backend
      dockerfile: Dockerfile.rchaincloudbackend
    volumes:
    - ./app:/root/app
    - ./app/node_modules:/root/app/node_modules:cached
    ports:
    - ${BACKEND_PORT}:80
    networks:
    - rnode-net

networks:
  rnode-net:
    name: rnode-net

volumes:
  rchain-cloud-data:
